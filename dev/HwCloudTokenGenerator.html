<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Huawei Cloud Token Generator</title>
</head>
<body>
    <div>领域号<input id="domain-name"><input type="checkbox" id="identical">与用户名保持一致</div>
    <div>用户名<input id="user-name"></div>
    <div>密码<input type="password" id="password"></div>
    <button id="btn-generate">生成</button>
    <div>令牌<textarea id="token"></textarea></div>
</body>
<script>

    document.getElementById('btn-generate').addEventListener('click', function(){
    // 输入 domain-name, username, password
    var domainName = document.getElementById('domain-name').value;
    var userName = document.getElementById('user-name').value;
    var password = document.getElementById('password').value;
    // 输出 token
    var xhr = new XMLHttpRequest();
    // POST https://iam.cn-north-4.myhuaweicloud.com/v3/auth/tokens
    xhr.open("POST", "https://iam.cn-north-4.myhuaweicloud.com/v3/auth/tokens", true);
    // Content-Type: application/json 
    xhr.setRequestHeader('content-type', 'application-json');

    // Receive Header
    // Return:
    // X-Subject-Token
    xhr.onreadystatechange = function() {
        if (xhr.readyState == 4){
            if (xhr.getResponseHeader('content-type') === 'application/json'){
                console.log(xhr.responseText);
            }
        }
    }

    var sendData = { 
        auth: { 
            identity: { 
                methods: [ 
                    "password" 
                ], 
                password: { 
                    user: { 
                        name: userName, 
                        password: password, 
                        domain: { 
                            name: domainName
                        } 
                    } 
                } 
            }, 
            scope: { 
                project: { 
                    name: "cn-north-4" 
                } 
            } 
        } 
    }
    xhr.send(JSON.stringify(sendData));

    // TODO: Blocked by some policy.
    // Access to XMLHttpRequest at 'https://iam.cn-north-4.myhuaweicloud.com/v3/auth/tokens' from origin 'null' has been blocked by CORS policy: Response to preflight request doesn't pass access control check: No 'Access-Control-Allow-Origin' header is present on the requested resource.

    });
    
</script>
</html>